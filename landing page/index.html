<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Resume Analyzer - Career Path Predictor</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.2em;
            opacity: 0.9;
        }

        .card {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            margin-bottom: 20px;
        }

        .upload-area {
            border: 3px dashed #667eea;
            border-radius: 10px;
            padding: 40px;
            text-align: center;
            transition: all 0.3s ease;
            cursor: pointer;
            background: #f8f9ff;
        }

        .upload-area:hover {
            border-color: #764ba2;
            background: #f0f1ff;
        }

        .upload-area.dragover {
            border-color: #764ba2;
            background: #e8e9ff;
            transform: scale(1.02);
        }

        .upload-icon {
            font-size: 4em;
            color: #667eea;
            margin-bottom: 15px;
        }

        .upload-area h3 {
            color: #333;
            margin-bottom: 10px;
            font-size: 1.3em;
        }

        .upload-area p {
            color: #666;
            font-size: 0.95em;
        }

        #fileInput {
            display: none;
        }

        .file-info {
            display: none;
            background: #e8f5e9;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
            border-left: 4px solid #4caf50;
        }

        .file-info.show {
            display: block;
        }

        .file-info strong {
            color: #2e7d32;
        }

        .analyze-btn {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1.1em;
            font-weight: bold;
            cursor: pointer;
            margin-top: 20px;
            transition: all 0.3s ease;
        }

        .analyze-btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .analyze-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        .loading {
            display: none;
            text-align: center;
            padding: 30px;
        }

        .loading.show {
            display: block;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: scale(0.9); }
            to { opacity: 1; transform: scale(1); }
        }

        .results {
            display: none;
        }

        .results.show {
            display: block;
            animation: fadeIn 0.5s ease-in;
        }

        .ats-score {
            text-align: center;
            padding: 30px;
            margin-bottom: 25px;
            border-radius: 10px;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
        }

        .ats-score.excellent {
            background: linear-gradient(135deg, #d4fc79 0%, #96e6a1 100%);
        }

        .ats-score.good {
            background: linear-gradient(135deg, #fddb92 0%, #d1fdff 100%);
        }

        .ats-score.fair {
            background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%);
        }

        .ats-score.poor {
            background: linear-gradient(135deg, #ff9a9e 0%, #fecfef 100%);
        }

        .score-circle {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            background: white;
            margin: 0 auto 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3em;
            font-weight: bold;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .prediction-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            border-radius: 10px;
            margin-bottom: 25px;
            text-align: center;
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.4);
            border: 3px solid rgba(255, 255, 255, 0.3);
        }

        .prediction-card h2 {
            font-size: 2.2em;
            margin-bottom: 5px;
            text-transform: uppercase;
            letter-spacing: 2px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .prediction-card p {
            font-size: 1.1em;
            opacity: 0.9;
            margin-bottom: 10px;
        }

        .confidence-bar {
            background: rgba(255,255,255,0.3);
            height: 30px;
            border-radius: 15px;
            overflow: hidden;
            margin-top: 15px;
        }

        .confidence-fill {
            height: 100%;
            background: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            transition: width 1s ease;
        }

        .top-predictions {
            margin-bottom: 25px;
        }

        .top-predictions h3 {
            color: #333;
            margin-bottom: 15px;
            font-size: 1.3em;
            border-bottom: 2px solid #667eea;
            padding-bottom: 10px;
        }

        .prediction-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 15px;
            background: #f8f9ff;
            border-radius: 8px;
            margin-bottom: 10px;
            border-left: 4px solid #667eea;
        }

        .prediction-item:nth-child(2) {
            border-left-color: #764ba2;
        }

        .prediction-item:nth-child(3) {
            border-left-color: #9c89c6;
        }

        .questions-section {
            margin-bottom: 25px;
        }

        .questions-section h3 {
            color: #333;
            margin-bottom: 15px;
            font-size: 1.3em;
            border-bottom: 2px solid #667eea;
            padding-bottom: 10px;
        }

        .question-item {
            padding: 15px;
            background: #f8f9ff;
            border-radius: 8px;
            margin-bottom: 12px;
            border-left: 4px solid #667eea;
        }

        .question-item::before {
            content: "Q: ";
            font-weight: bold;
            color: #667eea;
        }

        .issues-section, .suggestions-section {
            margin-bottom: 25px;
        }

        .issues-section h3, .suggestions-section h3 {
            color: #333;
            margin-bottom: 15px;
            font-size: 1.3em;
            border-bottom: 2px solid #667eea;
            padding-bottom: 10px;
        }

        .issue-item {
            padding: 12px 15px;
            background: #ffebee;
            border-radius: 8px;
            margin-bottom: 10px;
            border-left: 4px solid #f44336;
        }

        .suggestion-item {
            padding: 12px 15px;
            background: #e8f5e9;
            border-radius: 8px;
            margin-bottom: 10px;
            border-left: 4px solid #4caf50;
        }

        .details-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .detail-item {
            padding: 15px;
            background: #f8f9ff;
            border-radius: 8px;
            text-align: center;
        }

        .detail-item strong {
            display: block;
            color: #667eea;
            margin-bottom: 5px;
            font-size: 0.9em;
        }

        .reset-btn {
            width: 100%;
            padding: 12px;
            background: #666;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1em;
            cursor: pointer;
            margin-top: 20px;
            transition: background 0.3s ease;
        }

        .reset-btn:hover {
            background: #444;
        }

        .error-message {
            display: none;
            padding: 15px;
            background: #ffebee;
            color: #c62828;
            border-radius: 8px;
            border-left: 4px solid #f44336;
            margin-top: 15px;
        }

        .error-message.show {
            display: block;
        }

        .footer {
            text-align: center;
            color: white;
            margin-top: 30px;
            opacity: 0.8;
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 1.8em;
            }

            .card {
                padding: 20px;
            }

            .score-circle {
                width: 120px;
                height: 120px;
                font-size: 2.5em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üéØ AI Resume Analyzer</h1>
            <p>Upload your resume and discover your ideal career path</p>
        </div>

        <div class="card" id="uploadCard">
            <div class="upload-area" id="uploadArea">
                <div class="upload-icon">üìÑ</div>
                <h3>Drop your resume here or click to browse</h3>
                <p>Supports PDF and DOCX files (Max 50MB)</p>
                <input type="file" id="fileInput" accept=".pdf,.docx" />
            </div>

            <div class="file-info" id="fileInfo">
                <strong>Selected File:</strong> <span id="fileName"></span> (<span id="fileSize"></span>)
            </div>

            <button class="analyze-btn" id="analyzeBtn" disabled>
                üöÄ Analyze Resume
            </button>

            <div class="error-message" id="errorMessage"></div>
        </div>

        <div class="card loading" id="loadingCard">
            <div class="spinner"></div>
            <h3>Analyzing your resume...</h3>
            <p>This may take a few seconds</p>
        </div>

        <div class="results" id="results">
            <!-- Summary Card -->
            <div class="card" id="summaryCard" style="display: none;">
                <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 25px; border-radius: 10px; text-align: center; margin-bottom: 20px;">
                    <h2 style="font-size: 1.8em; margin-bottom: 20px;">üìä Analysis Summary</h2>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 15px;">
                        <div style="background: rgba(255,255,255,0.15); padding: 20px; border-radius: 8px;">
                            <div style="font-size: 0.9em; opacity: 0.9; margin-bottom: 5px;">ATS Score</div>
                            <div id="summaryAtsScore" style="font-size: 2.5em; font-weight: bold;">--</div>
                        </div>
                        <div style="background: rgba(255,255,255,0.15); padding: 20px; border-radius: 8px;">
                            <div style="font-size: 0.9em; opacity: 0.9; margin-bottom: 5px;">Predicted Role</div>
                            <div id="summaryRole" style="font-size: 1.3em; font-weight: bold; text-transform: uppercase; letter-spacing: 1px;">--</div>
                            <div id="summaryConfidence" style="font-size: 0.9em; opacity: 0.9; margin-top: 5px;">--</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ATS Score Section -->
            <div class="card">
                <div class="ats-score" id="atsScore">
                    <h2>ATS Friendliness Score</h2>
                    <div class="score-circle" id="scoreCircle">--</div>
                    <h3 id="atsOverall">--</h3>
                    
                    <div class="details-grid" id="atsDetails"></div>
                </div>

                <div class="issues-section" id="issuesSection" style="display: none;">
                    <h3>‚ö†Ô∏è Issues Found</h3>
                    <div id="issuesList"></div>
                </div>

                <div class="suggestions-section" id="suggestionsSection" style="display: none;">
                    <h3>üí° Suggestions for Improvement</h3>
                    <div id="suggestionsList"></div>
                </div>
            </div>

            <!-- Career Prediction Section -->
            <div class="card" id="predictionCard" style="display: none;">
                <div class="prediction-card">
                    <h2 id="predictedRole">--</h2>
                    <p>Recommended Career Path</p>
                    <div class="confidence-bar">
                        <div class="confidence-fill" id="confidenceFill" style="width: 0%;">
                            <span id="confidenceText">0%</span>
                        </div>
                    </div>
                </div>

                <div class="top-predictions">
                    <h3>üèÜ Top 3 Matching Roles</h3>
                    <div id="topPredictionsList"></div>
                </div>

                <div class="questions-section">
                    <h3>‚ùì Suggested Interview Questions</h3>
                    <div id="questionsList"></div>
                </div>
            </div>

            <div class="card">
                <button class="reset-btn" id="resetBtn">
                    üîÑ Analyze Another Resume
                </button>
            </div>
        </div>

        <div class="footer">
            <p>Powered by Machine Learning & Natural Language Processing</p>
        </div>
    </div>

    <script>
        // API Configuration
        const API_URL = 'http://localhost:5000/api';
        const MAX_FILE_SIZE = 50 * 1024 * 1024; // 50MB

        // DOM Elements
        const uploadArea = document.getElementById('uploadArea');
        const fileInput = document.getElementById('fileInput');
        const fileInfo = document.getElementById('fileInfo');
        const fileName = document.getElementById('fileName');
        const fileSize = document.getElementById('fileSize');
        const analyzeBtn = document.getElementById('analyzeBtn');
        const errorMessage = document.getElementById('errorMessage');
        const uploadCard = document.getElementById('uploadCard');
        const loadingCard = document.getElementById('loadingCard');
        const results = document.getElementById('results');
        const resetBtn = document.getElementById('resetBtn');

        let selectedFile = null;

        // Upload area click
        uploadArea.addEventListener('click', () => {
            fileInput.click();
        });

        // Drag and drop events
        uploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadArea.classList.add('dragover');
        });

        uploadArea.addEventListener('dragleave', () => {
            uploadArea.classList.remove('dragover');
        });

        uploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadArea.classList.remove('dragover');
            
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                handleFileSelect(files[0]);
            }
        });

        // File input change
        fileInput.addEventListener('change', (e) => {
            if (e.target.files.length > 0) {
                handleFileSelect(e.target.files[0]);
            }
        });

        // Handle file selection
        function handleFileSelect(file) {
            errorMessage.classList.remove('show');
            
            // Validate file type
            const validTypes = ['application/pdf', 'application/vnd.openxmlformats-officedocument.wordprocessingml.document'];
            if (!validTypes.includes(file.type)) {
                showError('Please upload a PDF or DOCX file');
                return;
            }

            // Validate file size
            if (file.size > MAX_FILE_SIZE) {
                showError('File size must be less than 50MB');
                return;
            }

            selectedFile = file;
            fileName.textContent = file.name;
            fileSize.textContent = formatFileSize(file.size);
            fileInfo.classList.add('show');
            analyzeBtn.disabled = false;
        }

        // Format file size
        function formatFileSize(bytes) {
            if (bytes < 1024) return bytes + ' B';
            if (bytes < 1024 * 1024) return (bytes / 1024).toFixed(2) + ' KB';
            return (bytes / (1024 * 1024)).toFixed(2) + ' MB';
        }

        // Show error message
        function showError(message) {
            errorMessage.textContent = message;
            errorMessage.classList.add('show');
        }

        // Analyze button click
        analyzeBtn.addEventListener('click', async () => {
            if (!selectedFile) return;

            console.log('=== Starting Analysis ===');
            console.log('File:', selectedFile.name, 'Size:', selectedFile.size);

            // Hide error and upload card, show loading
            errorMessage.classList.remove('show');
            uploadCard.style.display = 'none';
            loadingCard.classList.add('show');
            results.classList.remove('show');

            try {
                // Prepare form data
                const formData = new FormData();
                formData.append('file', selectedFile);

                console.log('Sending request to:', `${API_URL}/upload-resume`);

                // Make API call
                const response = await fetch(`${API_URL}/upload-resume`, {
                    method: 'POST',
                    body: formData
                });

                console.log('Response status:', response.status);

                const data = await response.json();
                console.log('Response data:', data);

                if (!response.ok) {
                    throw new Error(data.error || 'Failed to analyze resume');
                }

                // Check what we got back
                console.log('ATS Check:', data.ats_check);
                console.log('Analysis:', data.analysis);
                console.log('Has prediction?', !!data.analysis);

                // Hide loading, show results
                loadingCard.classList.remove('show');
                displayResults(data);
                results.classList.add('show');

                console.log('=== Analysis Complete ===');

            } catch (error) {
                console.error('=== Error During Analysis ===');
                console.error('Error:', error);
                console.error('Error message:', error.message);
                loadingCard.classList.remove('show');
                uploadCard.style.display = 'block';
                showError(error.message || 'Failed to analyze resume. Please try again.');
            }
        });

        // Display results
        function displayResults(data) {
            console.log('Full API Response:', data); // Debug log
            
            // Show summary card
            const summaryCard = document.getElementById('summaryCard');
            const summaryAtsScore = document.getElementById('summaryAtsScore');
            const summaryRole = document.getElementById('summaryRole');
            const summaryConfidence = document.getElementById('summaryConfidence');
            
            summaryAtsScore.textContent = data.ats_check.score;
            
            if (data.analysis) {
                summaryRole.textContent = data.analysis.predicted_role;
                summaryConfidence.textContent = `${(data.analysis.confidence * 100).toFixed(1)}% confidence`;
                summaryCard.style.display = 'block';
            } else {
                summaryRole.textContent = 'N/A';
                summaryConfidence.textContent = 'Score below 70%';
                summaryCard.style.display = 'block';
            }
            
            // Display ATS Check Results
            displayATSResults(data.ats_check);

            // Display ML Analysis if available
            if (data.analysis) {
                console.log('Analysis data found:', data.analysis); // Debug log
                displayPredictionResults(data.analysis);
                document.getElementById('predictionCard').style.display = 'block';
            } else {
                console.log('No analysis data - ATS score may be too low'); // Debug log
                document.getElementById('predictionCard').style.display = 'none';
                
                // Show message if ATS score is below threshold
                if (data.ats_check && data.ats_check.score < 70) {
                    const predictionCard = document.getElementById('predictionCard');
                    predictionCard.innerHTML = `
                        <div style="padding: 30px; text-align: center; background: #fff3cd; border-radius: 10px; margin: 20px 0;">
                            <h3 style="color: #856404; margin-bottom: 15px;">‚ö†Ô∏è Career Prediction Not Available</h3>
                            <p style="color: #856404; margin-bottom: 10px;">
                                Your resume's ATS score is below 70%. To get an accurate career path prediction, 
                                please improve your resume based on the suggestions above.
                            </p>
                            <p style="color: #856404; font-size: 0.9em;">
                                <strong>Current ATS Score:</strong> ${data.ats_check.score}%<br>
                                <strong>Required:</strong> 70%+
                            </p>
                        </div>
                    `;
                    predictionCard.style.display = 'block';
                }
            }
        }

        // Display ATS results
        function displayATSResults(atsCheck) {
            const score = atsCheck.score;
            const scoreCircle = document.getElementById('scoreCircle');
            const atsScore = document.getElementById('atsScore');
            const atsOverall = document.getElementById('atsOverall');

            // Set score
            scoreCircle.textContent = score;
            scoreCircle.style.color = getScoreColor(score);
            atsOverall.textContent = atsCheck.overall;

            // Set background class
            atsScore.className = 'ats-score';
            if (score >= 85) atsScore.classList.add('excellent');
            else if (score >= 70) atsScore.classList.add('good');
            else if (score >= 50) atsScore.classList.add('fair');
            else atsScore.classList.add('poor');

            // Display details
            const atsDetails = document.getElementById('atsDetails');
            atsDetails.innerHTML = Object.entries(atsCheck.details)
                .map(([key, value]) => `
                    <div class="detail-item">
                        <strong>${formatKey(key)}</strong>
                        <span>${value}</span>
                    </div>
                `).join('');

            // Display issues
            if (atsCheck.issues.length > 0) {
                document.getElementById('issuesSection').style.display = 'block';
                document.getElementById('issuesList').innerHTML = atsCheck.issues
                    .map(issue => `<div class="issue-item">${issue}</div>`)
                    .join('');
            } else {
                document.getElementById('issuesSection').style.display = 'none';
            }

            // Display suggestions
            if (atsCheck.suggestions.length > 0) {
                document.getElementById('suggestionsSection').style.display = 'block';
                document.getElementById('suggestionsList').innerHTML = atsCheck.suggestions
                    .map(suggestion => `<div class="suggestion-item">${suggestion}</div>`)
                    .join('');
            } else {
                document.getElementById('suggestionsSection').style.display = 'none';
            }
        }

        // Display prediction results
        function displayPredictionResults(analysis) {
            console.log('Displaying prediction:', analysis.predicted_role); // Debug log
            
            // Predicted role - Make it very prominent
            const predictedRoleElement = document.getElementById('predictedRole');
            predictedRoleElement.textContent = analysis.predicted_role;
            predictedRoleElement.style.animation = 'fadeIn 0.5s ease-in';

            // Confidence
            const confidence = (analysis.confidence * 100).toFixed(1);
            const confidenceFill = document.getElementById('confidenceFill');
            const confidenceText = document.getElementById('confidenceText');
            
            setTimeout(() => {
                confidenceFill.style.width = confidence + '%';
                confidenceText.textContent = confidence + '%';
            }, 100);

            // Top 3 predictions
            const topPredictionsList = document.getElementById('topPredictionsList');
            topPredictionsList.innerHTML = analysis.top_3_roles
                .map(([role, prob], index) => `
                    <div class="prediction-item">
                        <span><strong>${index + 1}.</strong> ${role}</span>
                        <span><strong>${(prob * 100).toFixed(1)}%</strong></span>
                    </div>
                `).join('');

            // Interview questions
            const questionsList = document.getElementById('questionsList');
            questionsList.innerHTML = analysis.interview_questions
                .map(question => `<div class="question-item">${question}</div>`)
                .join('');
            
            // Scroll to prediction card smoothly
            setTimeout(() => {
                document.getElementById('predictionCard').scrollIntoView({ 
                    behavior: 'smooth', 
                    block: 'start' 
                });
            }, 500);
        }

        // Helper functions
        function getScoreColor(score) {
            if (score >= 85) return '#2e7d32';
            if (score >= 70) return '#f57c00';
            if (score >= 50) return '#d84315';
            return '#c62828';
        }

        function formatKey(key) {
            return key.split('_')
                .map(word => word.charAt(0).toUpperCase() + word.slice(1))
                .join(' ');
        }

        // Reset button
        resetBtn.addEventListener('click', () => {
            selectedFile = null;
            fileInput.value = '';
            fileInfo.classList.remove('show');
            analyzeBtn.disabled = true;
            errorMessage.classList.remove('show');
            uploadCard.style.display = 'block';
            results.classList.remove('show');
        });
    </script>
</body>
</html>